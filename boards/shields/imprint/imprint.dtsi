#include <dt-bindings/zmk/matrix_transform.h>
#include <input/processors.dtsi>
#include <dt-bindings/zmk/input_transform.h>

/ {
	chosen {
		zmk,kscan = &kscan0;
		zmk,matrix_transform = &keymap_transform_0;
	};

	default_transform: keymap_transform_0 {
	compatible = "zmk,matrix-transform";
		columns = <6>;
		rows = <14>;
		map = <
					  RC(4,5) RC(4,4) RC(4,3) RC(4,2) RC(4,1) RC(4,0)                           RC(11,0) RC(11,1) RC(11,2) RC(11,3) RC(11,4) RC(11,5)
					  RC(3,5) RC(3,4) RC(3,3) RC(3,2) RC(3,1) RC(3,0)                           RC(10,0) RC(10,1) RC(10,2) RC(10,3) RC(10,4) RC(10,5)
					  RC(2,5) RC(2,4) RC(2,3) RC(2,2) RC(2,1) RC(2,0)                           RC(9,0)  RC(9,1)  RC(9,2)  RC(9,3)  RC(9,4)  RC(9,5)
					                  RC(1,3) RC(1,2)                                                             RC(8,2)  RC(8,3)
					  RC(0,7)                                   RC(7,7)
					  RC(0,3) RC(0,2)                   RC(7,2) RC(7,3)
			  >;
	};

	kscan0: kscan {
		compatible = "zmk,kscan-gpio-matrix";
		label = "KSCAN";

		wakeup-source;

		diode-direction = "row2col";
		col-gpios
		= <&gpio1 13 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col2 from schematic
		, <&gpio1 11 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col3 from schematic
		, <&gpio0 31 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col4 from schematic
		, <&gpio0 22 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col5 from schematic
		, <&gpio0 24 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col6 from schematic
		, <&gpio0 20 (GPIO_ACTIVE_HIGH | GPIO_PULL_DOWN)> // col7 from schematic
		;

	};

	//right hand trackball
	split_inputs {
		#address-cells = <1>;
		#size-cells = <0>;

		trackball_peripheral_split: trackball_peripheral_split@0 {
			compatible = "zmk,input-split";
			reg = <0>;
		};
	};

	trackball_peripheral_listener: trackball_peripheral_listener {
		compatible = "zmk,input-listener";
		status = "disabled";
		device = <&trackball_peripheral_split>;
	};
	//left hand trackball
	trackball_central_listener: trackball_central_listener {
		compatible = "zmk,input-listener";
		status = "disabled";
	};
};
